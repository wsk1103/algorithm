import java.util.Stack;

/**
 * @author sk
 * @time 2021/11/3
 * @desc say
 **/
public class L84 {

	/**
	 * 给定非负整数数组 heights ，数组中的数字用来表示柱状图中各个柱子的高度。每个柱子彼此相邻，且宽度为 1 。
	 * <p>
	 * 求在该柱状图中，能够勾勒出来的矩形的最大面积。
	 * <p>
	 * <p>
	 * <p>
	 * 示例 1:
	 * <p>
	 * <p>
	 * <p>
	 * 输入：heights = [2,1,5,6,2,3]
	 * 输出：10
	 * 解释：最大的矩形为图中红色区域，面积为 10
	 * 示例 2：
	 * <p>
	 * <p>
	 * <p>
	 * 输入： heights = [2,4]
	 * 输出： 4
	 * <p>
	 * <p>
	 * 提示：
	 * <p>
	 * 1 <= heights.length <=105
	 * 0 <= heights[i] <= 104
	 */

	public static int handle(int[] heights) {
		int max = heights[0];
		for (int i = 1; i < heights.length; i++) {
			int min = heights[i];
			for (int j = i - 1; j >= 0; j--) {
				min = Math.min(min, heights[j]);
				if (heights[i] <= heights[j]) {
					if (min == heights[0]) {
						j = 0;
					} else {
						heights[j] = heights[i];
					}
				}
				int temp = Math.max(heights[i], min * (i - j + 1));
				max = Math.max(temp, max);
			}
		}
		return max;
	}

	public static int handle2(int[] heights) {
		int max = heights[0];
		Stack<Integer> stack = new Stack<>();

		for (int i = 0; i < heights.length; i++) {
			max = Math.max(max, heights[i]);
			if (stack.isEmpty()) {
				stack.push(i);
				continue;
			}
			int last = stack.peek();
			if (heights[last] < heights[i]) {
				for (int j = stack.size() - 1; j >= 0; j--) {
					int t = stack.get(j);
					int tempMax = heights[t] * (i - t + 1);
					max = Math.max(max, tempMax);
				}
				stack.push(i);
 			} else {
				int temp = -1;
				while (heights[i] <= heights[last]) {
					temp = stack.pop();
					if (stack.isEmpty()) {
						break;
					}
					last = stack.peek();
				}
				if (temp >= 0) {
					heights[temp] = heights[i];
					stack.push(temp);
				}

				for (int j = stack.size() - 1; j >= 0; j--) {
					int t = stack.get(j);
					int tempMax = heights[t] * (i - t + 1);
					max = Math.max(max, tempMax);
				}
			}

		}
		return max;
	}

	public static void main(String[] args) {
		int[] h;
		h = new int[]{1207, 4171, 1848, 6005, 9195, 6160, 7580, 9881, 9450, 9573, 4228, 2501, 3146, 9303, 546, 1042, 875, 8684, 6979, 847, 1826, 7511, 2545, 342, 8305, 7561, 7835, 9630, 6522, 3485, 3234, 372, 2042, 3367, 1900, 9649, 4853, 5848, 2556, 3473, 2172, 30, 2877, 3677, 7661, 2918, 9644, 7227, 2787, 7306, 8534, 9302, 4665, 5156, 7631, 7290, 5766, 9934, 4292, 5366, 1469, 8629, 9921, 7274, 8000, 7125, 687, 1044, 1281, 8047, 1591, 7734, 9768, 6916, 408, 414, 7320, 5841, 101, 8156, 3627, 6997, 8136, 9642, 4336, 9216, 2093, 4545, 484, 7034, 2362, 1890, 6067, 5384, 2220, 2895, 5457, 3999, 216, 3340, 4777, 9598, 732, 5039, 2210, 8633, 1136, 4952, 498, 9815, 781, 3040, 8550, 4041, 220, 1212, 6896, 19, 4641, 8849, 7694, 2866, 9787, 6518, 2452, 302, 8382, 6662, 9579, 1618, 1469, 1846, 6698, 7015, 7972, 5530, 8650, 7798, 7749, 1856, 7222, 7892, 6208, 1521, 5612, 7314, 9982, 2433, 9265, 503, 971, 9165, 7315, 3764, 325, 8094, 6103, 994, 8178, 3048, 2039, 1189, 5142, 4341, 3904, 68, 5987, 5880, 7161, 8220, 312, 9272, 9735, 5905, 9787, 5409, 8128, 7262, 8628, 6714, 7584, 4760, 8523, 1591, 1477, 9194, 8568, 5598, 2366, 2229, 5417, 3251, 2941, 1399, 1420, 9709, 6378, 2071, 8971, 2679, 5445, 6216, 5031, 8792, 830, 9171, 3517, 4188, 8159, 8266, 7014, 9676, 5418, 7206, 1137, 7337, 5918, 2702, 5973, 9445, 5176, 4752, 1755, 4785, 5127, 1571, 829, 677, 2056, 4955, 1828, 5058, 2377, 6059, 6074, 158, 4499, 4149, 7508, 4530, 3901, 9534, 2147, 540, 4666, 9488, 2653, 4609, 1086, 2062, 474, 3548, 8281, 8443, 1437, 1695, 9189, 2115, 3378, 4509, 908, 5097, 8627, 3246, 5643, 3336, 7974, 1021, 1473, 6512, 8530, 4060, 7358, 3966, 1162, 5579, 6863, 3475, 7127, 947, 296, 8010, 8919, 1202, 5548, 9785, 3666, 8220, 2956, 4111, 9591, 9366, 2821, 4301, 2014, 1648, 3390, 188, 4668, 3696, 7476, 5665, 6510, 9453, 2295, 5164, 6326, 7289, 231, 7523, 3681, 4078, 8152, 3726, 114, 5137, 2819, 2497, 6582, 3721, 2727, 3740, 3173, 2855, 9957, 3817, 9319, 9579, 223, 376, 6194, 680, 3761, 8985, 8448, 710, 8213, 3858, 3961, 9387, 1415, 4712, 4556, 527, 4116, 173, 6455, 9214, 23, 5848, 1458, 8112, 3025, 5777, 4817, 639, 2954, 8787, 9827, 183, 4626, 8241, 5815, 9084, 753, 305, 8474, 9654, 6968, 4132, 9324, 4610, 4567, 5444, 8413, 6533, 3389, 7790, 7695, 6468, 1531, 6702, 7795, 8286, 2731, 7876, 6930, 3629, 1784, 342, 9323, 9302, 2186, 3931, 4064, 3051, 452, 4846, 4117, 4268, 5068, 6251, 4854, 7362, 5273, 1508, 3747, 6603, 8751, 7942, 4541, 1568, 5671, 2214, 6660, 6125, 2006, 2947, 4370, 154, 6952, 1375, 1340, 8283, 7941, 7784, 4970, 5548, 3962, 7036, 6822, 5787, 1322, 4723, 422, 9389, 4929, 3480, 4607, 5136, 4452, 6837, 3040, 4937, 6155, 5831, 941, 2075, 2793, 3054, 1798, 2189, 9349, 4136, 2303, 3970, 2049, 1469, 6861, 9514, 2302, 4191, 518, 4330, 2017, 3457, 5110, 4958, 5257, 9448, 5114, 272, 5159, 913, 4387, 8110, 1733, 562, 3817, 8383, 1796, 7438, 1462, 5950, 9706, 4646, 8496, 2080, 4283, 9666, 6027, 6557, 4767, 7910, 3490, 8451, 7949, 8353, 9426, 4895, 6064, 5809, 345, 6086, 19, 8038, 5270, 9704, 6962, 8605, 9673, 2097, 7048, 4964, 3740, 6095, 9441, 2615, 5537, 9759, 8574, 5264, 3833, 2572, 4506, 4068, 4699, 1079, 3193, 6598, 3415, 8511, 930, 7928, 2556, 9096, 4419, 984, 8284, 1013, 9603, 9497, 8687, 9977, 6372, 6012, 4840, 6151, 8076, 5894, 3153, 3766, 7190, 8435, 6567, 4297, 2575, 3053, 7282, 7869, 4765, 4325, 7303, 3332, 7740, 1214, 8390, 6184, 8825, 154, 2324, 8348, 7898, 1866, 6656, 9404, 3127, 9821, 7780, 6328, 9827, 1922, 7074, 8609, 7470, 2584, 3728, 7123, 3197, 3268, 5036, 3918, 7865, 124, 9972, 3372, 6652, 4815, 5682, 4663, 2698, 1031, 5901, 9553, 9502, 3858, 8976, 8789, 3424, 690, 8622, 4128, 88, 2793, 6186, 628, 9717, 5991, 4790, 3916, 976, 9508, 6869, 2586, 6561, 1296, 7799, 603, 2878, 1560, 2043, 5686, 6923, 8636, 6149, 6437, 8792, 2088, 4749, 1057, 3733, 6550, 1750, 9330, 5667, 2565, 4468, 8590, 3274, 8370, 8886, 9293, 3367, 6992, 7680, 4044, 9472, 5040, 317, 7886, 7261, 5902, 8827, 1337, 1858, 3017, 8927, 1101, 2470, 3956, 9230, 6218, 3741, 5767, 6953, 5926, 9525, 1377, 4851, 7316, 6805, 2838, 6833, 6354, 8961, 298, 9361, 7978, 4903, 4806, 3685, 2452, 3071, 5874, 2486, 4484, 3098, 7967, 6655, 1919, 8744, 7973, 7850, 4065, 3721, 8594, 3216, 4826, 7246, 2983, 1149, 1239, 6395, 6369, 6738, 6794, 8698, 9622, 7361, 4257, 5153, 9132, 3552, 2918, 3607, 2573, 3092, 5704, 1948, 1176, 4560, 7734, 8607, 5591, 668, 2967, 704, 560, 8919, 3367, 3289, 1200, 9897, 6561, 2840, 9545, 6520, 5078, 7734, 2806, 628, 8061, 2750, 3663, 2635, 9410, 1904, 8178, 4123, 9998, 3946, 1871, 7373, 2521, 3967, 5111, 327, 3431, 1239, 6777, 1140, 1871, 6909, 4098, 924, 8742, 8936, 7680, 182, 3398, 2160, 1988, 7069, 2889, 2274, 1107, 5723, 7985, 6719, 2788, 7143, 7395, 4267, 3287, 2822, 3088, 8638, 968, 6098, 7906, 9801, 3365, 4173, 4372, 5272, 8627, 2752, 6352, 5211, 8320, 1725, 7392, 7946, 5175, 9857, 9964, 4576, 6458, 6694, 4972, 2292, 5741, 2379, 5485, 4257, 8021, 6732, 2295, 5288, 1736, 2228, 4212, 4285, 1424, 4666, 2463, 6371, 5179, 3619, 1457, 8807, 31, 5884, 1103, 670, 4811, 5778, 5019, 5994, 9456, 4007, 3829, 2304, 2981, 2040, 5475, 5861, 7375, 1191, 1059, 2287, 5424, 2770, 3741, 8879, 9168, 8456, 5163, 7589, 1986, 6736, 3837, 4014, 2310, 7977, 2894, 245, 4463, 9191, 336, 8431, 7703, 8469, 1980, 3854, 4120, 7482, 912, 267, 8864, 8504, 7921, 9586, 9384, 7183, 4514, 1508, 9650, 7987, 678, 6112, 7682, 9534, 5515, 2662, 8658, 2982, 3050, 3233, 734, 9057, 8406, 6541, 4429, 8338, 9472, 6404, 2792, 4938, 7723, 5128, 9653, 7699, 7334, 5320, 2322, 7934, 5968, 2642, 2853, 5667, 4661, 885, 9049, 8253, 9659, 934, 4276, 237, 5774, 1352, 5405, 2495, 6924, 2581, 281, 8039, 6602, 275, 4155, 4388, 8921, 7979, 5562, 6470, 2089, 5522, 5127, 3843, 5559, 2325, 5562, 7962, 7829, 9099, 7063, 118, 3123, 2845, 1336, 8300, 4169, 1915, 8267, 4321, 1291, 1392, 8654, 7374, 2738, 4816, 1372, 7302, 2266, 9054, 5689, 4128, 3777, 4615, 3688, 4004, 4773, 1208, 8650, 6551, 5004, 6573, 4236, 6225, 2672, 3269, 3793, 1383, 8515, 9070, 7819, 4255, 4273, 7210, 8635, 8136, 3691, 2076, 8677, 3796, 3154, 7303, 3004, 5901, 9859, 5367, 8589, 8223, 5134, 2282, 6804, 9188, 4056, 8310, 6043, 730, 570, 1860, 1365, 1158, 3791, 2900, 9258, 2836, 4893, 8220, 7717, 5736, 7038, 6804, 2108, 3518, 7744, 2110, 7867, 5598, 2893, 1222, 5065, 31, 7248, 4855, 6303, 1010, 4558, 8616, 434, 9173, 5374, 8300, 3173, 9422, 731, 6377, 6972, 2984, 3373, 5222, 6610, 1286, 8753, 3609, 2163, 3015, 1202, 3120, 4705, 7394, 2621, 1054, 7387, 3968, 4174, 4329, 7924, 9874, 3102, 345, 2771, 3861, 1727, 7844, 5514, 4755, 5443, 6820, 2904, 2253, 9963, 9164, 6551, 7528, 2595, 5280, 1627, 4956, 6322, 553, 8224, 2328, 4111, 7119, 797, 6848, 1241, 9275, 7090, 7082, 1504, 2832, 8694, 392, 5392, 3083, 9423, 4775, 3040, 7037, 8436, 4295, 8206, 3518, 6668, 4025, 9287, 1538, 3497, 1620, 3629, 5295, 3993, 1345, 2453, 9427, 5753, 1291, 961, 3955, 2688, 7885, 5051, 4751, 6021, 2993, 1135, 1679, 787, 1966, 4159, 705, 7158, 8731, 9653, 5894, 8988, 5633, 5257, 4786, 5168, 4225, 3900, 5055, 4444, 2326, 7123, 4346, 6662, 9999, 9025, 5897, 1452, 6556, 8953, 8488, 1869, 1840, 5888, 2814, 9956, 8369, 9179, 8265, 5323, 206, 7292, 5129, 9608, 7561, 9170, 6233, 3873, 498, 8486, 7799, 1279, 9666, 5441, 4169, 5801, 5099, 7922, 1445, 4135, 3272, 8470, 7340, 8380, 4771, 1334, 8620, 4483, 775, 262, 7455, 3417, 7561, 4477, 982, 1187, 5170, 9172, 1303, 7439, 9446, 7643, 2024, 5049, 161, 1131, 2651, 6499, 4083, 4292, 7122, 5619, 8027, 3640, 6718, 4843, 2477, 3049, 2726, 3441, 2636, 1858, 5741, 3278, 6419, 9060, 3952, 3559, 6062, 8586, 9614, 3776, 6536, 795, 142, 9967, 6496, 6468, 5695, 2905, 5221, 4034, 4011, 5619, 9378, 3505, 4924, 6594, 5193, 9085, 7635, 5249, 1480, 2698, 1421, 1701, 1238, 3606, 5257, 3005, 4501, 770, 327, 5870, 8682, 4597, 3985, 9667, 2458, 6966, 498, 6882, 4085, 9625, 8864, 2805, 140, 6182, 8419, 4178, 7105, 7318, 109, 7216, 981, 2686, 6827, 5937, 3911, 3567, 4215, 8250, 4504, 2052, 6428, 7574, 3591, 7990, 6758, 8001, 4210, 3344, 1432, 1273, 8802, 2796, 1966, 545, 7867, 6067, 7798, 3603, 9395, 3455, 6096, 3298, 3438, 3359, 751, 7159, 6269, 7713, 9029, 1357, 4378, 4173, 3159, 5835, 5352, 8273, 3321, 2178, 2176, 7239, 2238, 5720, 7958, 6043, 9217, 3295, 3351, 697, 1414, 1675, 6581, 866, 5329, 9525, 4238, 4899, 9940, 2038, 6539, 3297, 9732, 932, 1732, 7863, 5947, 2308, 297, 8172, 3186, 8383, 8158, 2382, 9839, 4245, 8320, 4890, 6162, 8499, 1572, 3701, 5138, 1792, 2472, 1610, 679, 8884, 774, 9654, 4282, 7276, 8535, 6195, 8685, 6937, 3966, 9265, 7097, 5788, 2773, 7888, 7198, 9726, 5397, 628, 5379, 1727, 7761, 2876, 530, 8680, 8403, 7277, 773, 2236, 5855, 2470, 2872, 4819, 7508, 1385, 3746, 6498, 3852, 707, 6148, 4953, 1094, 8851, 9823, 781, 5302, 8913, 6811, 2849, 6920, 6394, 5696, 9645, 436, 166, 7142, 2623, 6083, 7230, 9363, 3464, 9022, 5017, 1220, 5619, 9895, 5209, 2986, 8167, 2711, 4894, 2731, 8122, 7256, 5364, 821, 1820, 4598, 4354, 2965, 1977, 6059, 961, 3563, 9763, 2730, 9615, 8877, 7641, 6338, 1957, 1418, 2324, 7631, 827, 3060, 1504, 2446, 8343, 5980, 950, 1459, 1425, 6302, 6039, 6723, 7611, 8507, 7807, 3400, 6378, 2989, 3193, 9269, 6805, 6754, 9001, 2951, 91, 5473, 8355, 289, 8927, 2184, 1045, 1376, 3333, 4322, 957, 3897, 2742, 156, 670, 7526, 4429, 882, 7464, 7188, 1857, 5348, 911, 4252, 1470, 4666, 8418, 8350, 1522, 4180, 9761, 6177, 7180, 3285, 9782, 6686, 3436, 64, 821, 9413, 1146, 8893, 2986, 1564, 929, 4571, 769, 9272, 7139, 1954, 5626, 5134, 4847, 4096, 1193, 2823, 2620, 3256, 4682, 7033, 5842, 2405, 1144, 9675, 7008, 9766, 9677, 7673, 5038, 1108, 6834, 4972, 3016, 2214, 7342, 3888, 6241, 4189, 4408, 620, 1014, 1059, 4168, 611, 7297, 1058, 5022, 6899, 536, 9898, 4256, 7745, 5819, 9565, 5739, 5423, 8511, 5273, 213, 1372, 5617, 7046, 8953, 8882, 1988, 1196, 9762, 9176, 8967, 2869, 5143, 7711, 6300, 3756, 5983, 2272, 8706, 6382, 1756, 564, 3334, 4721, 8540, 3921, 7741, 9416, 6270, 7391, 8719, 2126, 80, 9892, 5211, 3579, 7163, 1128, 2401, 3925, 4702, 5234, 826, 6314, 3825, 338, 2282, 1004, 9746, 861, 7112, 1011, 498};
		System.err.println(handle2(h));
		//76104
		h = new int[]{2,1,5,6,2,3};
		System.err.println(handle2(h));
		h = new int[]{5, 4, 1, 2};
		System.err.println(handle2(h));
		h = new int[]{1,2,2};
		System.err.println(handle2(h));
		h = new int[]{8180,8180,8180,8180,8180,8180,8180,8180,8180,8180,8180,8180,8180,8180,8180,8180};
		System.err.println(handle2(h));
	}

}
